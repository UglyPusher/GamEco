/// [AI: PURPOSE] Предварительные размышления об архитектуре структуры агентов.
/// [AI: NOTE] Формирует основу для различения регистрации, привязки, принадлежности.
/// Подлежит уточнению при развитии симуляции и добавлении контроллеров.

# Архитектура экономических агентов: регистрация и структура

## 1. Регистрация (юридическая привязка)

/// [AI: DESIGN] Каждый экономический агент должен быть зарегистрирован в другом объекте, отражающем “место его принадлежности” в системе.

- `IndividualEconomicObject` регистрируется в `GroupEconomicObject` (например, в селе).
- `Enterprise` регистрируется в `Settlement`.
- `Settlement` регистрируется в `Municipality`.
- `Caravan` зарегистрирован в родном `Settlement`, даже если физически находится в другом.

Регистрация:
- обязательна при создании (для индивидуалов, предприятий и сёл),
- влияет на налогообложение, биржевой доступ, социальную структуру.

## 2. Отличие регистрации от логической принадлежности

| Механизм         | Что означает                         | Примеры                                 |
|------------------|---------------------------------------|------------------------------------------|
| **Регистрация**  | Юридическая приписка                  | место рождения, налоговая прописка       |
| **Принадлежность**| Логическая или социальная группа      | семья, предприятие, отряд                |
| **Присутствие**  | Физическое местоположение             | путешествие, караван в другом селе       |

## 3. Архитектурные классы и базовая иерархия

```cpp
class BaseEconomicAgent {
protected:
    GroupEconomicObject* registry_ = nullptr;
public:
    virtual void registerTo(GroupEconomicObject* group);
    virtual void unregister(); // если допустимо
};

class IndividualEconomicObject : public BaseEconomicAgent {
    // Хранит навыки, может менять регистрацию, часть семьи, игрок или NPC
};

class GroupEconomicObject : public BaseEconomicAgent {
    // Может принимать регистрацию других агентов: село, муниципалитет, предприятие (в теории)
};
BaseEconomicAgent — базовый класс с resources_, step(), id

GroupEconomicObject реализует addRegisteredAgent() / removeRegisteredAgent()

IndividualEconomicObject управляет своей регистрацией самостоятельно

4. Создание агентов и регистрация
Агент создаётся без жёсткой привязки, но:

Регистрация в GroupEconomicObject должна быть вызвана явно сразу после создания:

cpp
Copy
Edit
auto agent = std::make_shared<IndividualEconomicObject>();
agent->registerTo(settlement);
Для Enterprise и Settlement регистрация происходит сразу при конструировании и не может быть изменена.

5. Уточнения и правила регистрации
📌 Можно ли перегружать registerTo() с логикой контроля?
/// [AI: DESIGN] Да — registerTo() может быть виртуальным и включать:

проверку типа регистратора;

проверки прав, квот, лимитов населения;

отклонение регистрации при несовпадении критериев.

📌 Должна ли регистрация происходить автоматически при addStepable()?
/// [AI: RULE] Нет. Добавление в stepables_ (например, работника на предприятие) не означает регистрацию.
/// Регистрация — это независимый юридический акт.

📌 Как организовать отмену регистрации?
/// [AI: RULE] Только индивидуальный агент (IndividualEconomicObject) может отменить регистрацию.
/// Это делает сам агент, вызывая unregister():

cpp
Copy
Edit
void IndividualEconomicObject::unregister() {
    if (registry_) {
        registry_->removeStepable(this->getId());
        registry_ = nullptr;
    }
}
Предприятия, поселения и муниципалитеты не могут быть разрегистрированы после создания.

Никто другой не может “выселить” или “разорвать” регистрацию индивидуала.

6. Возможные направления расширения
/// [AI: FUTURE]

Возможность миграции с регистрацией: согласование между сёлами

Журнал регистрации и смены “гражданства”

Разделение между HomeSettlement и CurrentResidence

Поддержка мульти-регистрации (например, двойное гражданство?)

Оформление регистрации как контракта или соглашения